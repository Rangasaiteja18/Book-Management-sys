<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Book Store Management</title>

    <!-- Modern Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Poppins", sans-serif;
            background-color: #d3f8d3; /* light green */
            margin: 0;
            padding: 25px;
        }

        h1 {
            text-align: center;
            font-size: 36px;
            font-weight: 600;
            margin-bottom: 30px;
        }

        /* Books Grid */
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .book-card {
            background: white;
            width: 260px;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }

        .book-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 10px;
        }

        button {
            padding: 10px 14px;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            margin-right: 5px;
        }

        .update-btn { background: #1d4ed8; }
        .delete-btn { background: #e63946; }

        /* Form Section */
        #form-section {
            background: white;
            max-width: 420px;
            margin: 40px auto;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #aaa;
        }

        #submit-btn {
            width: 100%;
            background: #16a34a;
        }

        /* Live Image Preview */
        #preview {
        #preview {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            object-fit: cover;
            display: none;
            margin-top: 10px;
        }

        footer {
            text-align: center;
            font-size: 18px;
            margin-top: 40px;
            color: #333;
        }
    </style>
</head>
<body>

<h1>Online Book Store Management</h1>

<div id="books-container" class="container"></div>

<!-- FORM -->
<div id="form-section">
    <h3 id="form-title">Add / Update Book</h3>

    <input type="text" id="title" placeholder="Book Title">
    <input type="text" id="author" placeholder="Author">
    <input type="text" id="image" placeholder="Image URL" oninput="previewImage()">

    <img id="preview" alt="Preview">

    <button id="submit-btn" onclick="submitBook()">Submit</button>
</div>

<footer>
    <p>âœ” REST API Integrated | Online Book Store</p>
</footer>

<script>
    const API_BASE = "http://localhost:8080";
    let updateId = null;

    // Load all books
    async function loadBooks() {
        const res = await fetch(`${API_BASE}/getbooks`);
        const books = await res.json();

        const container = document.getElementById("books-container");
        container.innerHTML = "";

        books.forEach(book => {
            container.innerHTML += `
                <div class="book-card">
                    <img src="${book.image}" alt="Book Image"
                         onerror="this.src='https://via.placeholder.com/260x220?text=No+Image'">
                    <h3>${book.title}</h3>
                    <p><b>Author:</b> ${book.author}</p>
                    <button class="update-btn" onclick="editBook(${book.id})">Update</button>
                    <button class="delete-btn" onclick="deleteBook(${book.id})">Delete</button>
                </div>
            `;
        });
    }

    // Delete book
    async function deleteBook(id) {
        await fetch(`${API_BASE}/books/${id}`, {
            method: "DELETE",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({id})
        });

        loadBooks();
    }

    // Load book info into form for updating
    async function editBook(id) {
        updateId = id;

        const res = await fetch(`${API_BASE}/getbooks`);
        const books = await res.json();
        const book = books.find(b => b.id === id);

        document.getElementById("title").value = book.title;
        document.getElementById("author").value = book.author;
        document.getElementById("image").value = book.image;

        previewImage();

        document.getElementById("form-title").innerText = "Update Book";
    }

    // Add / Update book
    async function submitBook() {
        const book = {
            title: document.getElementById("title").value,
            author: document.getElementById("author").value,
            image: document.getElementById("image").value
        };

        if (updateId) {
            // UPDATE
            await fetch(`${API_BASE}/books/${updateId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(book)
            });

            updateId = null;
            document.getElementById("form-title").innerText = "Add / Update Book";

        } else {
            // CREATE
            await fetch(`${API_BASE}/books`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(book)
            });
        }

        // Clear form
        document.getElementById("title").value = "";
        document.getElementById("author").value = "";
        document.getElementById("image").value = "";
        document.getElementById("preview").style.display = "none";

        loadBooks();
    }

    // Live Image Preview
    function previewImage() {
        const url = document.getElementById("image").value;
        const preview = document.getElementById("preview");

        if (url.trim() !== "") {
            preview.src = url;
            preview.style.display = "block";
        } else {
            preview.style.display = "none";
        }
    }

    // Load books on page load
    window.onload = loadBooks;
</script>

</body>
</html>
